<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../Resources/style.css"/>
    <title>זירה 7</title>
    <style>
        body
        {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            direction: rtl;
            text-align: right;
            min-height:100%;
            font-size: 5vh;
            opacity: 1;
        }
        .background
        {
            width: 100%;
            height: 250%;
            min-height:250%;
        }
        .container
        {
            width: 100%;
            height: 100%;
            position: relative;
            margin: 0;
            padding: 0;
            min-height:100%;
            /*margin-left: 5%;
            margin-right: 5%;*/
        }
        #zone_text
        {
            position: absolute;
            top: 55%;
            right: 3%;
            min-height:100%;
        }
        #final_div
        {
            text-align: center;
            position: absolute;
            top: 45%;
            right: 15%;
            font-size: 5vh;
        }
        #giving_code
        {
            text-align: center;
            position: absolute;
            top: 45%;
            right: 30%;
            font-size: 10vh;
            color: mediumseagreen;
            display: none;
        }
        
        /* The Modal (The text box instead of the basic alert) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            direction: rtl;
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            color: red;
            font-size: 6vh;
            text-align: center;
            font-family: "Arial";
        }

        /* The Close Button */
        .close {
            color: #000;
            float: right;
            font-size: 9vh;
            font-weight: bolder;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    
    <script type="application/javascript">
        localStorage.setItem("reloaded", "false");
        
        // Checks if player finished all of the stations.
        function checkFinished()
        {
            var s = "";
            var val = "";
            for(var i = 1; i <= 8; i++)
            {
                s = "for_" + i;
                val = localStorage.getItem(s);
                if(val == null || val != "OK")
                {
                    return false;
                }
            }

            return true;
        }
        function CheckEnd()
        {
            var form = document.getElementById("final");
            var inputs = form.getElementsByTagName("input");
            s = ""
            for(var i = inputs.length - 1; i >= 0; i --)
            {
                s += inputs[i].value;
            }

            s = s.toLowerCase();
            if(s.localeCompare("face134") == 0)
            {
                document.getElementById("incorrect_div").style.display = "none";
                setTimeout(function(){
                    document.getElementById("form_div").style.display = "none";
                    document.getElementById("zone_text").style.display = "none";
                    document.getElementById("head").style.display = "none";
                    document.getElementById("code_head").style.display = "none";
                    document.getElementById("final_div").innerHTML = "נכון, הקוד הוסף אוטומטית למאגר (סטטוס הקודים – בדף הבית). <br>גלול למעלה וחזור לדף הבית.";
                    setTimeout(function(){
                        document.getElementById("giving_code").style.display = "none";
                    }, 250);
                    localStorage.setItem("for_7", "OK");

                    if(checkFinished())
                    {
                        alert("כל הכבוד, סיימת את כל התחנות !\nאנא גש לדף הבית, לחץ על סטטוס הקודים, וחשוף את סוף המשימה !");
                    }
                    
                    document.location.href = "#final_div";
                }, 250);
            }
            else
            {
                document.getElementById("incorrect_div").innerHTML = "לא נכון נסו שוב";
            }
        }
        function Init()
        {
            var form = document.getElementById("final");
            var inputs = form.getElementsByTagName("input");
            for(var k = inputs.length - 1; k > 0 ; k--)
            {
                (function()
                {
                    var inp = inputs[k];
                    var next_inp = inputs[k - 1];
                    if(next_inp.disabled)
                    {
                        if( k - 2 >= inputs.length)
                        {

                        }
                        else
                        {
                            next_inp = inputs[k - 2];
                        }
                    }
                    inp.addEventListener("input", function(event)
                    {
                        if(inp.value != "")
                        {
                            next_inp.focus();     
                        }
                    });
                }());
            }
        }

        function Start()
        {
            Init(1,false);
            //setTimeout(OfferHint,300000);
        }

        function StartGame()
        {
            document.location.href = "https://out4in.github.io/out4in.github.io/onlinear/EscapeZone/Station_7/game.html";
        }
    </script>
</head>
<body onload="Start();">
    <div class="container">
        <img src = "../Resources/stations-background.jpg" class="background" id="background_img">
        <a href = "../Welcome/index.html"><img src = "../Resources/home-icon.png" id = "HomeIcon" title = "לחץ כדי לחזור לדף הבית"></a>
        
        <div id = "giving_code">
            <b>הקוד הוא: face134</b>
        </div>
        
        <div id = "explain">
            <img src = "../Resources/clock.png" id = "clockImg" title = "כאשר סמל זה ייעלם מן המסך, יופיע רמז.">
            <div id = "head" style = "position: absolute; top: 35%; left: 33%; font-size: 6vh;">
                <b><i>זירה 7 - הקלסתרון</i></b>
            </div>
            
            <p id="zone_text">
                עזרו למשטרה למצוא את קלסתרון ראש הכנופיה. חפשו וסרקו באמצעות הטלפון הסלולארי 16 ברקודים המסומנים בריבוע אדום.<br/>
                <font color = "red" style="font-weight: bold">הערה חשובה: עליכם לסרוק את הברקודים רק לפי סדר המספרים מ 1-16.</font><br/>
                בתום הסריקה תקבלו את כל החלקים בסלולארי.<br/>
                כדי להרכיב את הקלסתרון עליכם ללחוץ כל פעם על שני חלקים שיחליפו ביניהם מקום עד להרכבת התמונה במלואה.<br/>
                בסיום הרכבת הקלסתרון תקבלו את קוד הזירה: מילה באנגלית עם 4 אותיות ומספר תלת ספרתי.<br/>
                הזינו את הקוד בתיבת הטקסט המתאימה בסיום המשימה.<br/>
            </p>
            <div style="text-align: center; position: absolute; top: 125%; left: 33%;"><br><br>
                <button type="button" class="btn btn-primary btn-lg btn-block" style="width: 100%; background-color: red; border-color: red; font-size: 5vh;" onclick="StartGame();">לחץ כדי להתחיל את המשחק</button>
            </div>
        </div>
        
        <div class="Content" id = "form_div" style="text-align: center; position: absolute; top: 80%; right: 24%; display: none;">
            <div id = "code_head" style="text-decoration: underline; margin-bottom: 3%; font-size: 5vh;">הקוד הוא: </div>
            <form id="final">
                <input type="text" class="mini_txt" id="final_1" maxlength="7"/>
                <!--<input type="text" class="mini_txt" id="final_2" maxlength="1"/>
                <input type="text" class="mini_txt" id="final_3" maxlength="1"/>
                <input type="text" class="mini_txt" id="final_4" maxlength="1"/>
                <input type="text" class="mini_txt" id="final_5" maxlength="1"/>
                <input type="text" class="mini_txt" id="final_6" maxlength="1"/>
                <input type="text" class="mini_txt" id="final_7" maxlength="1"/>-->
            </form>
            <div align = "Center">
                <button type="button" class="btn btn-primary btn-lg btn-block" style="width: 35%; background-color: red; border-color: red;" onclick="CheckEnd();">בדוק</button>
            </div>
            <div id="incorrect_div">
            </div>
        </div>
        <div id="final_div">
        </div>
    </div>
    
    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>
                אנא הפכו את הטלפון למצב שוכב<br/>
                <div align = "center"><img src = "../Resources/vertical_to_horizontal.png" alt="מצטערים, משהו קרה עם התמונה." style="width: 20%; height: 20%;"></div>
            </p>
        </div>
    </div>
    
    <script>
        /*
            This script's purpose is that when the keyboard is open,
            the text will disappear and the form will jump up, because 
            otherwise the text and the form gets confused and it very
            inconvenient.
        */
        var text = document.getElementById("zone_text");
        var form = document.getElementById("form_div");
        var form_input = document.getElementById("final_1");
        //var form_input2 = document.getElementById("final_2");
        var clicked = false;
        var s = "";
        setInterval(function(){
            if($(document.activeElement).attr('type') == "text")    //Keyobard is open
            {
                if(!clicked)
                {
                    console.log("Keyboard is visible");

                    /*for(var i = 7; i >= 1; i--)     //finds first clear input.
                    {
                        s = "final_" + i;
                        form_input = document.getElementById(s);
                        if(form_input.value.length <= 0)
                        {
                            break;   
                        }
                    }*/
                    
                    text.style.display = "none";
                    //document.getElementById("head").style.display = "none";
                    document.getElementById("giving_code").style.display = "none";
                    document.getElementById("code_head").style.display = "none";
                    document.getElementById("background_img").style.height = "250%";
                    $("#form_div").animate({ top: '60%', right: '24%' }, 0);
                    document.location.href = "#form_div";
                    form_input.focus();
                    form_input.select();
                    clicked = !clicked;
                    //form_input.style.display = "block";   
                }
            }
            else
            {
                if(clicked)
                {
                    console.log("Keyboard is NOT visible");
                    text.style.display = "block";
                    //document.getElementById("head").style.display = "block";
                    document.getElementById("giving_code").style.display = "block";
                    document.getElementById("code_head").style.display = "block";
                    document.getElementById("background_img").style.height = "100%";
                    $("#form_div").animate({ top: '60%', right: '24%' }, 0);
                    document.location.href = "#form_div";
                    clicked = !clicked;
                }
            }
        }, 100);
    </script>
    
    
    <!-- Modal Script -->
    <script>
        var modal = document.getElementById('myModal');
        var span = document.getElementsByClassName("close")[0];
        var passed_turn = false;
        
        span.onclick = function() {
            modal.style.display = "none";
            passed_turn = localStorage.getItem("passed_turn");
            
            if(passed_turn == "false" || !passed_turn)
            {
                window.location.reload(false);
            }
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                passed_turn = localStorage.getItem("passed_turn");
                
                if(passed_turn == "false" || !passed_turn)
                {
                    window.location.reload(false);
                }
            }
        }
    </script>
    
    <script>
        var url = window.location.href;
        if(url.indexOf("finish=yes") != -1)
        {
            if(window.innerHeight > window.innerWidth)
            {
                localStorage.setItem("passed_turn", false);
                modal.style.display = "block";
            }
            else
            {
                localStorage.setItem("passed_turn", true);
            }
            
            document.getElementById("explain").style.display = "none";
            document.getElementById("form_div").style.display = "block";
            document.getElementById("background_img").style.height = "100%";
            document.getElementById("form_div").style.height = "60%";
            document.getElementById("giving_code").style.display = "block";
        }
    
    </script>
</body>
</html>