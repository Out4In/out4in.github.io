<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="../Resources/style.css"/>
        <title>זירה 4</title>
        <style>
        body
            {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                direction: rtl;
                text-align: right;
                min-height:100%;
                font-size: 5vh;
            }
            .background
            {
                width: 100%;
                height: 250%;
                min-height:250%;
            }
            .container
            {
                width: 100%;
                height: 100%;
                position: relative;
                margin: 0;
                padding: 0;
                min-height:100%;
                /*margin-left: 5%;
                margin-right: 5%;*/
            }
            #zone_text
            {
                position: absolute;
                top: 55%;
                right: 3%;
                min-height:100%;
            }
            #final_div
            {
                text-align: center;
                position: absolute;
                top: 45%;
                right: 15%;
                font-size: 5vh;
            }
    </style>
        
        <script type="application/javascript">
            localStorage.setItem("reloaded", "false");
            
            // Checks if player finished all of the stations.
            function checkFinished()
            {
                var s = "";
                var val = "";
                for(var i = 1; i <= 8; i++)
                {
                    s = "for_" + i;
                    val = localStorage.getItem(s);
                    if(val == null || val != "OK")
                    {
                        return false;
                    }
                }
                
                return true;
            }
            
            function CheckEnd()
            {
                var form = document.getElementById("final");
                var inputs = form.getElementsByTagName("input");
                s = ""
                for(var i = inputs.length - 1; i >= 0; i --)
                {
                    s += inputs[i].value;
                }
                
                s = s.toLowerCase();
                if(s.localeCompare("clue815") == 0)
                {
                    document.getElementById("incorrect_div").style.display = "none";
                    setTimeout(function(){
                        document.getElementById("form_div").style.display = "none";
                        document.getElementById("zone_text").style.display = "none";
                        document.getElementById("head").style.display = "none";
                        document.getElementById("code_head").style.display = "none";
                        document.getElementById("final_div").innerHTML = "נכון, הקוד הוסף אוטומטית למאגר (סטטוס הקודים – בדף הבית). <br>גלול למעלה וחזור לדף הבית.";
                        localStorage.setItem("for_4", "OK");
                        
                        if(checkFinished())
                        {
                            alert("כל הכבוד, סיימת את כל התחנות !\nאנא גש לדף הבית, לחץ על סטטוס הקודים, וחשוף את סוף המשימה !");
                        }
                        
                        document.location.href = "#final_div";
                    }, 250);
                }
                else
                {
                    document.getElementById("incorrect_div").innerHTML = "לא נכון נסו שוב";
                }
            }
            function Init()
            {
                var form = document.getElementById("final");
                var inputs = form.getElementsByTagName("input");
                for(var k = inputs.length - 1; k > 0 ; k--)
                {
                    (function()
					{
						var inp = inputs[k];
						var next_inp = inputs[k - 1];
						if(next_inp.disabled)
						{
							if( k - 2 >= inputs.length)
							{

							}
							else
							{
								next_inp = inputs[k - 2];
							}
						}
						inp.addEventListener("input", function(event)
						{
							if(inp.value != "")
							{
								next_inp.focus();     
							}
						});
                    }());
                }
            }
            
            function OfferHint()
            {
                var answer = confirm("ראינו שאתם מתקשים, האם אתם רוצים עזרה?");
                if(answer)
                {
                     var clockImg = document.getElementById("clockImg");
                    clockImg.style.display = "none";
                    setTimeout(function(){          //To remove image before alert.
                        alert("מסתבר שהסגן הוא האיש הכי עשיר מהכנופיה. זה שמממן אותה מהרווחים של המלון שלו.\nחברו את המספר שמופיע על תמונת המלון עם 610.\nצרפו אליו את קוד המילה באנגלית בת 4 האותיות המופיעה על לוח החקירה, והכניסו את הקוד לתיבת הקוד.");
                    }, 250);
                }
                else
                {
                    setTimeout(OfferHint, 60000);
                }
            }
            
            function Start()
            {
                Init();
                setTimeout(OfferHint,300000);
            }
        </script>
        
    </head>
    <body onload="Start();">
        <div class="container">
            <img src = "../Resources/stations-background.jpg" class="background" id="background_img">
            <a href = "../Welcome/index.html"><img src = "../Resources/home-icon.png" id = "HomeIcon" title = "לחץ כדי לחזור לדף הבית"></a>
            <img src = "../Resources/clock.png" id = "clockImg" title = "כאשר סמל זה ייעלם מן המסך, יופיע רמז.">
            <div id = "head" style = "position: absolute; top: 35%; left: 33%; font-size: 6vh;">
                <b><i>זירה 4 - לוח חקירות</i></b>
            </div>
            <p id="zone_text">
                <u>מהמשטרה נמסר :</u><br/>
                בכנופיה 5 חברים אך אין מידע על מנהיג הכנופיה.<br/>
                על לוח החקירות שלפניכם מופיעים פרטים על ארבע חברי כנופיה בלבד, אחד מהם הוא סגן מפקד הכנופיה.<br/>
                המשימה שלכם היא לאתר את הסגן.<br/>
                 המשטרה אספה רמזים על חברי הכנופיה, עליכם להתאים בין הרמזים לבין חברי הכנופיה. <br/>
                חבר הכנופיה שיקבל את מספר הרמזים הגדול ביותר – הוא הסגן. <br/>

                <u>מציאת קוד הזירה:</u><br/>
                על הרמזים (של הסגן) מופיעים מספרים סכמו אותם ותקבלו מספר בן שלוש ספרות וצרפו אליו את המילה באנגלית בת 4 הספרות אותה תמצאו על לוח החקירות.
            </p>
            <div class="Content" id = "form_div" style="text-align: center; position: absolute; top: 145%; right: 24%;">
                <div id = "code_head" style="text-decoration: underline; margin-bottom: 3%; font-size: 5vh;">הקוד הוא: </div>
                <form id="final">
                    <input type="text" class="mini_txt" id="final_1" maxlength="7"/>
                    <!--<input type="text" class="mini_txt" id="final_2" maxlength="1"/>
                    <input type="text" class="mini_txt" id="final_3" maxlength="1"/>
                    <input type="text" class="mini_txt" id="final_4" maxlength="1"/>
                    <input type="text" class="mini_txt" id="final_5" maxlength="1"/>
                    <input type="text" class="mini_txt" id="final_6" maxlength="1"/>
                    <input type="text" class="mini_txt" id="final_7" maxlength="1"/>-->
                </form>
                <div align = "Center">
                    <button type="button" class="btn btn-primary btn-lg btn-block" style="width: 35%; background-color: red; border-color: red;" onclick="CheckEnd();">בדוק</button>
                </div>
                <div id="incorrect_div">
                </div>
            </div>
            <div id="final_div">
            </div>
        </div>
        
        
        <script>
            /*
                This script's purpose is that when the keyboard is open,
                the text will disappear and the form will jump up, because 
                otherwise the text and the form gets confused and it very
                inconvenient.
            */
            var text = document.getElementById("zone_text");
            var form = document.getElementById("form_div");
            var form_input = document.getElementById("final_1");
            //var form_input2 = document.getElementById("final_2");
            var clicked = false;
            var s = "";
            setInterval(function(){
                if($(document.activeElement).attr('type') == "text")    //Keyobard is open
                {
                    if(!clicked)
                    {
                        console.log("Keyboard is visible");
                        
                        /*for(var i = 7; i >= 1; i--)     //finds first clear input.
                        {
                            s = "final_" + i;
                            form_input = document.getElementById(s);
                            if(form_input.value.length <= 0)
                            {
                                break;   
                            }
                        }*/
                        
                        text.style.display = "none";
                        document.getElementById("head").style.display = "none";
                        document.getElementById("code_head").style.display = "none";
                        $("#form_div").animate({ top: '80%', right: '24%' }, 0);
                        document.location.href = "#form_div";
                        form_input.focus();
                        form_input.select();
                        clicked = !clicked;
                        //form_input.style.display = "block";   
                    }
                }
                else
                {
                    if(clicked)
                    {
                        console.log("Keyboard is NOT visible");
                        text.style.display = "block";
                        document.getElementById("head").style.display = "block";
                        document.getElementById("code_head").style.display = "block";
                        $("#form_div").animate({ top: '145%', right: '24%' }, 0);
                        document.location.href = "#form_div";
                        clicked = !clicked;
                    }
                }
            }, 100);
        </script>
    </body>
</html>